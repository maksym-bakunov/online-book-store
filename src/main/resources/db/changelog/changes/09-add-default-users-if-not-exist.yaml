databaseChangeLog:
  - changeSet:
      id: add-admin-if-not-exist
      author: mpbakunov
      preConditions:
        - onFail: CONTINUE
        - sqlCheck:
            expectedResult: 0
            sql: "SELECT COUNT(*) FROM users_roles INNER JOIN roles ON users_roles.role_id = roles.id
             WHERE roles.name = 'ADMIN'"
      changes:
        - insert:
            tableName: users
            columns:
              - column:
                  name: email
                  value: 'admin@skyline.com'
              - column:
                  name: password
                  value: admin
              - column:
                  name: first_name
                  value: admin
              - column:
                  name: last_name
                  value: admin
        - sql:
            sql: |
              INSERT INTO users_roles (user_id, role_id)
              VALUES ((SELECT id FROM users WHERE email = 'admin@skyline.com'),
              (SELECT id FROM roles WHERE name = 'ADMIN'));          

  - changeSet:
      id: add-user-if-not-exist
      author: mpbakunov
      preConditions:
        - onFail: CONTINUE
        - sqlCheck:
            expectedResult: 0
            sql: "SELECT COUNT(*) FROM users_roles INNER JOIN roles ON users_roles.role_id = roles.id
             WHERE roles.name = 'USER'"
      changes:
        - insert:
            tableName: users
            columns:
              - column:
                  name: email
                  value: 'user@skyline.com'
              - column:
                  name: password
                  value: user
              - column:
                  name: first_name
                  value: user
              - column:
                  name: last_name
                  value: user
        - sql:
            sql: |
              INSERT INTO users_roles (user_id, role_id)
              VALUES ((SELECT id FROM users WHERE email = 'admin@skyline.com'),
              (SELECT id FROM roles WHERE name = 'USER'));